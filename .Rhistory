all_ratios <- all_qtrs %>%
pivot_wider(names_from=wbhao, values_from = thresh700)
all_ratios <- all_qtrs %>%
filter(gender='All') %>%
pivot_wider(names_from=wbhao, values_from = thresh700)
all_ratios <- all_qtrs %>%
filter(gender='All') %>%
pivot_wider(names_from=wbhao, values_from = thresh700)
all_ratios <- all_qtrs %>%
filter(gender=='All') %>%
pivot_wider(names_from=wbhao, values_from = thresh700)
all_ratios <- all_qtrs %>%
filter(gender=='All') %>%
pivot_wider(names_from=c(wbhao,state), values_from = thresh700)
all_ratios <- all_qtrs %>%
filter(gender=='All') %>%
pivot_wider(names_from=c(wbhao), values_from = thresh700)
#Unemployment rate maps/tables
current_urates <- all_qtrs %>%
filter(gender=='All') %>%
arrange(wbhao) %>%
pivot_wider(id_cols=c(state), names_from = c(qtr, wbhao), values_from = c(thresh700), names_prefix = 'c_')
reference_urates <- reference_quarter_output %>%
filter(gender=='All') %>%
pivot_wider(id_cols=state, names_from = wbhao, values_from = c(thresh700:thresh100), names_prefix = 'r_')
all_ratios <- all_qtrs %>%
filter(gender=='All') %>%
pivot_wider(names_from=c(wbhao), values_from = thresh700)
all_ratios <- all_qtrs %>%
select(gender, wbhao, thresh700, state) %>%
filter(gender=='All') %>%
pivot_wider(names_from=c(wbhao), values_from = thresh700)
all_ratios <- all_qtrs %>%
filter(gender=='All') %>%
select(wbhao, thresh700, state) %>%
pivot_wider(names_from=c(wbhao), values_from = thresh700)
all_ratios <- all_qtrs %>%
filter(gender=='All')# %>%
select(wbhao, thresh700, state, qtr) %>%
pivot_wider(names_from=c(wbhao), values_from = thresh700)
all_ratios <- all_qtrs %>%
filter(gender=='All') %>%
select(wbhao, thresh700, state, qtr) %>%
pivot_wider(names_from=c(wbhao), values_from = thresh700)
all_ratios <- all_qtrs %>%
filter(gender=='All') %>%
select(wbhao, thresh700, state, qtr) %>%
pivot_wider(names_from=c(wbhao), values_from = thresh700) %>%
mutate(bw.ratio = Black/White,
hw.ratio = Hispanic/White)
all_ratios <- all_qtrs %>%
filter(gender=='All') %>%
select(wbhao, thresh700, state, qtr) %>%
pivot_wider(names_from=c(wbhao), values_from = thresh700) %>%
mutate(bw.ratio = Black/White,
hw.ratio = Hispanic/White) %>%
select(state, qtr, bw.ratio, hw.ratio)
all_ratios <- all_qtrs %>%
filter(gender=='All') %>%
select(wbhao, thresh700, state, qtr) %>%
pivot_wider(names_from=c(wbhao), values_from = thresh700) %>%
mutate(bw.ratio = Black/White,
hw.ratio = Hispanic/White) %>%
select(state, qtr, bw.ratio, hw.ratio) %>%
pivot_wider(id_cols = qtr, names_from = state, values_from = c(bw.ratio, hw.ratio))
all_ratios <- all_qtrs %>%
filter(gender=='All') %>%
select(wbhao, thresh700, state, qtr) %>%
pivot_wider(names_from=c(wbhao), values_from = thresh700) %>%
mutate(bw.ratio = Black/White,
hw.ratio = Hispanic/White) %>%
select(state, qtr, bw.ratio, hw.ratio) %>%
pivot_wider(id_cols = state, names_from=qtr , values_from = c(bw.ratio, hw.ratio))
all_ratios <- all_qtrs %>%
filter(gender=='All') %>%
select(wbhao, thresh700, state, qtr) %>%
pivot_wider(names_from=c(wbhao), values_from = thresh700) %>%
mutate(bw.ratio = Black/White,
hw.ratio = Hispanic/White) %>%
select(state, qtr, bw.ratio, hw.ratio) %>%
pivot_wider(id_cols = state, names_from=qtr, values_from = c(bw.ratio, hw.ratio))
all_ratios <- all_qtrs %>%
filter(gender=='All') %>%
select(wbhao, thresh700, state, qtr) %>%
pivot_wider(names_from=c(wbhao), values_from = thresh700) %>%
mutate(bw.ratio = Black/White,
hw.ratio = Hispanic/White)# %>%
all_ratios <- all_qtrs %>%
filter(gender=='All') %>%
select(wbhao, thresh700, state, qtr) %>%
pivot_wider(names_from=c(wbhao), values_from = thresh700)# %>%
#empty lists to store dfs
output_dfs <- list()
state_analysis <- function(quarters){
for(i in 1:length(qtr_list)){
quarterly_laus <- laus %>%
filter(qtr==qtr_list[i+1]) %>%
group_by(st_abbr) %>%
summarize(laus_qtr_unemp = mean(urate))
state_urates <- cps %>%
filter(qtr==qtr_list[i] | qtr == qtr_list[i+1]) %>%
group_by(st_abbr) %>%
summarize(st_urate_6mos = weighted.mean(unemp, w=basicwgt/6, na.rm=TRUE))
us_subgroup_urates <- cps %>%
filter(qtr==qtr_list[i] | qtr==qtr_list[i+1]) %>%
mutate(overall= paste('US','-','All','-','All'),
gender = paste('US','-','All','-',female),
race = paste('US','-',wbhao,'-','All'),
genderXrace = paste('US','-',wbhao,'-',female)) %>%
summarize_groups(overall|race|gender|genderXrace,
subgroup_urate = weighted.mean(unemp, w=basicwgt/6, na.rm=TRUE),
n=n()) %>%
separate(group_value, c('st_abbr','wbhao','gender')) %>% #creates st_abbr, wbho, gender variables
mutate(st_urate_6mos = subgroup_urate[1],
st_abbr = 'US',
ratio = ifelse(subgroup_urate==0, NA, subgroup_urate/st_urate_6mos))
print(paste("Calculating subgroup urates for: ", qtr_list[i+1]))
all_subgroup_urates<- cps %>%
#restrict data to current quarters
filter(qtr==qtr_list[i] | qtr==qtr_list[i+1]) %>%
#create subgroup variables
mutate(stateXrace = paste(st_abbr,'-', wbhao,'-','All'),
stateXgender = paste(st_abbr,'-','All','-',female),
stXraceXgender = paste(st_abbr,'-',wbhao,'-',female)) %>%
#Estimate unemployment rates and sample sizes by subgroups
summarize_groups(st_abbr|stateXrace|stXraceXgender|stateXgender,
subgroup_urate = weighted.mean(unemp, w=basicwgt/6, na.rm=TRUE),
n=n()) %>%
#split group_value variable to create st_abbr, wbho, gender labels
separate(group_value, c('st_abbr','wbhao','gender')) %>%
#merge statefips labels by st_abbr to get fips codes and CPS estimated urates
left_join(state_urates) %>%
#get ratio of (6-month state avg:subgroup) unemployment rate
#NOTE: due to small sample sizes, occasionally subgroups show an unemployment rate of 0%
#Using ifelse() fcuntion, I avoid using these 0 values as a divisor.
mutate(ratio = ifelse(subgroup_urate==0, NA, subgroup_urate/st_urate_6mos)) %>%
arrange(st_abbr, desc(n)) %>%
#bind US unemployment rates
bind_rows(us_subgroup_urates) %>%
#merge quarterly laus unemp estimates
left_join(quarterly_laus) %>%
mutate(qtr_st_urate_by_reg = ratio * laus_qtr_unemp) %>%
# replace all values with a coefficient of variation below threshold to NA
mutate(thresh700 = replace(qtr_st_urate_by_reg, n<700, NA)) %>%
left_join(state_labels) %>%
select(state, st_abbr, gender, wbhao, n, subgroup_urate,
st_urate_6mos, ratio, laus_qtr_unemp, qtr_st_urate_by_reg, thresh700) %>% # Clean our data up
mutate(wbhao = replace_na(wbhao, 'All'),
gender = replace_na(gender, 'All'),
grp_qtrs = paste(qtr_list[i],'+',qtr_list[i+1]),
qtr = paste(qtr_list[i+1])) %>%
filter(wbhao!='Other')
output_dfs[[i]] <- all_subgroup_urates # save your dataframes into the list
}
return(output_dfs)
}
#call quarterly state function passing all quarters as arguments
my_state_dfs <- state_analysis(qtr_list)
#bind each data frame returned from function
all_qtrs <- bind_rows(my_state_dfs)
all_ratios <- all_qtrs %>%
filter(gender=='All') %>%
select(wbhao, thresh700, state, qtr) %>%
pivot_wider(names_from=c(wbhao), values_from = thresh700) %>%
mutate(bw.ratio = Black/White,
hw.ratio = Hispanic/White) %>%
select(state, qtr, bw.ratio, hw.ratio) %>%
pivot_wider(id_cols = state, names_from=qtr, values_from = c(bw.ratio, hw.ratio))
all_ratios <- all_qtrs %>%
filter(gender=='All') %>%
select(wbhao, thresh700, state, qtr) %>%
pivot_wider(names_from=c(wbhao), values_from = thresh700) %>%
mutate(bw.ratio = Black/White,
hw.ratio = Hispanic/White) %>%
select(state, qtr, bw.ratio, hw.ratio) %>%
pivot_wider(id_cols = (state,qtr), values_from = c(bw.ratio, hw.ratio))
all_ratios <- all_qtrs %>%
filter(gender=='All') %>%
select(wbhao, thresh700, state, qtr) %>%
pivot_wider(names_from=c(wbhao), values_from = thresh700) %>%
mutate(bw.ratio = Black/White,
hw.ratio = Hispanic/White) %>%
select(state, qtr, bw.ratio, hw.ratio) %>%
pivot_wider(id_cols = c(state,qtr), values_from = c(bw.ratio, hw.ratio))
all_ratios <- all_qtrs %>%
filter(gender=='All') %>%
select(wbhao, thresh700, state, qtr) %>%
pivot_wider(names_from=c(wbhao), values_from = thresh700) %>%
mutate(bw.ratio = Black/White,
hw.ratio = Hispanic/White) %>%
select(state, qtr, bw.ratio, hw.ratio) %>%
pivot_wider(id_cols = c(state,qtr), values_from = c(bw.ratio, hw.ratio)) %>%
filter(qtr!=NA) %>%
arrange(qtr)
all_ratios <- all_qtrs %>%
filter(gender=='All') %>%
select(wbhao, thresh700, state, qtr) %>%
pivot_wider(names_from=c(wbhao), values_from = thresh700) %>%
mutate(bw.ratio = Black/White,
hw.ratio = Hispanic/White) %>%
select(state, qtr, bw.ratio, hw.ratio) %>%
pivot_wider(id_cols = c(state,qtr), values_from = c(bw.ratio, hw.ratio)) %>%
#filter(qtr!=NA) %>%
arrange(qtr)
all_ratios <- all_qtrs %>%
filter(gender=='All') %>%
select(wbhao, thresh700, state, qtr) %>%
pivot_wider(names_from=c(wbhao), values_from = thresh700) %>%
mutate(bw.ratio = Black/White,
hw.ratio = Hispanic/White) %>%
select(state, qtr, bw.ratio, hw.ratio) %>%
pivot_wider(id_cols = c(state,qtr), values_from = c(bw.ratio, hw.ratio)) %>%
#filter(qtr!=NA) %>%
arrange(desc(qtr))
all_ratios <- all_qtrs %>%
filter(gender=='All') %>%
select(wbhao, thresh700, state, qtr) %>%
pivot_wider(names_from=c(wbhao), values_from = thresh700) %>%
mutate(bw.ratio = Black/White,
hw.ratio = Hispanic/White) %>%
select(state, qtr, bw.ratio, hw.ratio) %>%
pivot_wider(id_cols = c(state,qtr), values_from = c(bw.ratio, hw.ratio)) %>%
filter(qtr!='NA') %>%
arrange(desc(qtr))
all_ratios <- all_qtrs %>%
filter(gender=='All') %>%
select(wbhao, thresh700, state, qtr) %>%
pivot_wider(names_from=c(wbhao), values_from = thresh700) %>%
mutate(bw.ratio = Black/White,
hw.ratio = Hispanic/White) %>%
select(state, qtr, bw.ratio, hw.ratio)# %>%
all_ratios <- all_qtrs %>%
filter(gender=='All') %>%
select(wbhao, thresh700, state, qtr) %>%
pivot_wider(names_from=c(wbhao), values_from = thresh700) %>%
mutate(bw.ratio = Black/White,
hw.ratio = Hispanic/White) %>%
select(state, qtr, bw.ratio, hw.ratio) %>%
pivot_wider(id_cols = c(state,qtr), values_from = c(bw.ratio, hw.ratio))# %>%
all_ratios <- all_qtrs %>%
filter(gender=='All') %>%
select(wbhao, thresh700, state, qtr) %>%
pivot_wider(names_from=c(wbhao), values_from = thresh700) %>%
mutate(bw.ratio = Black/White,
hw.ratio = Hispanic/White) %>%
select(state, qtr, bw.ratio, hw.ratio)# %>%
all_ratios <- all_qtrs %>%
filter(gender=='All') %>%
select(wbhao, thresh700, state, qtr) %>%
pivot_wider(names_from=c(wbhao), values_from = thresh700) %>%
mutate(bw.ratio = Black/White,
hw.ratio = Hispanic/White) %>%
select(state, qtr, bw.ratio, hw.ratio) %>%
pivot_wider(id_cols = c(state),names_from = qtr, values_from = c(bw.ratio, hw.ratio))# %>%
all_ratios <- all_qtrs %>%
filter(gender=='All') %>%
select(wbhao, thresh700, state, qtr) %>%
pivot_wider(names_from=c(wbhao), values_from = thresh700) %>%
mutate(bw.ratio = Black/White,
hw.ratio = Hispanic/White) %>%
select(state, qtr, bw.ratio, hw.ratio)# %>%
all_ratios <- all_qtrs %>%
filter(gender=='All') %>%
select(wbhao, thresh700, state, qtr) %>%
pivot_wider(names_from=c(wbhao), values_from = thresh700) %>%
mutate(bw.ratio = Black/White,
hw.ratio = Hispanic/White) %>%
select(state, qtr, bw.ratio, hw.ratio) %>%
filter(qtr!='NA') %>%
arrange(desc(qtr))
all_ratios <- all_qtrs %>%
filter(gender=='All') %>%
select(wbhao, thresh700, state, qtr) %>%
pivot_wider(names_from=c(wbhao), values_from = thresh700) %>%
mutate(bw.ratio = Black/White,
hw.ratio = Hispanic/White) %>%
select(state, qtr, bw.ratio, hw.ratio)# %>%
all_ratios <- all_qtrs %>%
filter(gender=='All') %>%
select(wbhao, thresh700, state, qtr) %>%
pivot_wider(names_from=c(wbhao), values_from = thresh700) %>%
mutate(bw.ratio = Black/White,
hw.ratio = Hispanic/White) %>%
select(state, qtr, bw.ratio, hw.ratio) %>%
pivot_wider(id_cols = c(state), names_from = qtr, values_from = c(bw.ratio, hw.ratio))# %>%
all_ratios <- all_qtrs %>%
filter(gender=='All') %>%
select(wbhao, thresh700, state, qtr) %>%
pivot_wider(names_from=c(wbhao), values_from = thresh700) %>%
mutate(bw.ratio = Black/White,
hw.ratio = Hispanic/White) %>%
select(state, qtr, bw.ratio, hw.ratio) %>%
filter(qtr!='NA') %>%
arrange(desc(qtr))
all_ratios <- all_qtrs %>%
filter(gender=='All') %>%
select(wbhao, thresh700, state, qtr) %>%
pivot_wider(names_from=c(wbhao), values_from = thresh700) %>%
mutate(bw.ratio = Black/White,
hw.ratio = Hispanic/White) %>%
select(state, qtr, bw.ratio, hw.ratio) %>%
filter(qtr!='NA') %>%
arrange(desc(qtr)) %>%
pivot_wider(id_cols = c(state), names_from = qtr, values_from = c(bw.ratio, hw.ratio))# %>%
all_ratios <- all_qtrs %>%
filter(gender=='All') %>%
select(wbhao, thresh700, state, qtr) %>%
pivot_wider(names_from=c(wbhao), values_from = thresh700) %>%
mutate(bw.ratio = Black/White,
hw.ratio = Hispanic/White) %>%
select(state, qtr, bw.ratio, hw.ratio) %>%
filter(qtr!='NA') %>%
arrange(qtr) %>%
pivot_wider(id_cols = c(state), names_from = qtr, values_from = c(bw.ratio, hw.ratio))# %>%
all_ratios <- all_qtrs %>%
filter(gender=='All') %>%
select(wbhao, thresh700, state, qtr) %>%
pivot_wider(names_from=c(wbhao), values_from = thresh700) %>%
mutate(bw.ratio = Black/White,
hw.ratio = Hispanic/White) %>%
select(state, qtr, bw.ratio, hw.ratio) %>%
filter(qtr!='NA') %>%
pivot_wider(id_cols = c(state), names_from = qtr, values_from = c(bw.ratio, hw.ratio))# %>%
all_ratios <- all_qtrs %>%
filter(gender=='All') %>%
select(wbhao, thresh700, state, qtr) %>%
pivot_wider(names_from=c(wbhao), values_from = thresh700) %>%
mutate(bw.ratio = Black/White,
hw.ratio = Hispanic/White) %>%
select(state, qtr, bw.ratio, hw.ratio) %>%
filter(qtr!='NA') %>%
pivot_wider(id_cols = c(state), names_from = c(qtr,bw.ratio, hw.ratio), values_from = c(bw.ratio, hw.ratio))# %>%
all_ratios <- all_qtrs %>%
filter(gender=='All') %>%
select(wbhao, thresh700, state, qtr) %>%
pivot_wider(names_from=c(wbhao), values_from = thresh700) %>%
mutate(bw.ratio = Black/White,
hw.ratio = Hispanic/White,
ratio_label = ifelse(!is.na(bw.ratio), yes = 'bw.ratio',
ifelse(!is.na(hw.ratio), yes='hw.ratio',NA)))# %>%
all_ratios <- all_qtrs %>%
filter(gender=='All') %>%
select(wbhao, thresh700, state, qtr) %>%
pivot_wider(names_from=c(wbhao), values_from = thresh700) %>%
mutate(bw.ratio = Black/White,
hw.ratio = Hispanic/White) %>%
select(state, qtr, bw.ratio, hw.ratio) %>%
filter(qtr!='NA') %>%
pivot_wider(id_cols = c(state), names_from = c(qtr,bw.ratio, hw.ratio), values_from = c(bw.ratio, hw.ratio))# %>%
all_ratios <- all_qtrs %>%
filter(gender=='All') %>%
select(wbhao, thresh700, state, qtr) %>%
pivot_wider(names_from=c(wbhao), values_from = thresh700) %>%
mutate(bw.ratio = Black/White,
hw.ratio = Hispanic/White) %>%
select(state, qtr, bw.ratio, hw.ratio) %>%
filter(qtr!='NA') %>%
pivot_wider(id_cols = c(state), names_from = c(qtr), values_from = c(bw.ratio, hw.ratio))# %>%
all_ratios_long <- all_qtrs %>%
filter(gender=='All') %>%
select(wbhao, thresh700, state, qtr) %>%
pivot_wider(names_from=c(wbhao), values_from = thresh700) %>%
mutate(bw.ratio = Black/White,
hw.ratio = Hispanic/White) %>%
select(state, qtr, bw.ratio, hw.ratio) %>%
filter(qtr!='NA')
View(all_ratios_long)
all_ratios_long <- all_qtrs %>%
filter(gender=='All') %>%
select(wbhao, thresh700, state, qtr) %>%
pivot_wider(names_from=c(wbhao), values_from = thresh700) %>%
mutate(bw.ratio = Black/White,
hw.ratio = Hispanic/White) %>%
select(state, qtr, bw.ratio, hw.ratio) %>%
filter(qtr!='NA') %>%
arrange(desc(qtr))
View(all_qtrs)
View(all_qtrs)
change_ts <- all_qtrs %>%
select(state, wbhao, qtr, thresh700)
View(change_ts)
change_ts <- all_qtrs %>%
filter(gender=='All') %>%
select(state, wbhao, qtr, thresh700)
change_ts <- all_qtrs %>%
filter(gender=='All') %>%
select(state, wbhao, qtr, thresh700) %>%
pivot_wider(id_cols = c(state,wbhao), names_from = qtr, values_from = thresh700)
change_ts <- all_qtrs %>%
filter(gender=='All') %>%
select(state, wbhao, qtr, thresh700) %>%
pivot_wider(id_cols = c(state,wbhao), names_from = qtr, values_from = thresh700) %>%
select(state,wbhao,'2020 Q1':'2022 Q1')
change_ts <- all_qtrs %>%
filter(gender=='All') %>%
select(state, wbhao, qtr, thresh700) %>%
pivot_wider(id_cols = c(state,wbhao), names_from = qtr, values_from = thresh700) %>%
select(state,wbhao,'2020 Q1':'2022 Q1') %>%
mutate(across('2020 Q2':'2022Q1', ~.x-'2020 Q1'))
change_ts <- all_qtrs %>%
filter(gender=='All') %>%
select(state, wbhao, qtr, thresh700) %>%
pivot_wider(id_cols = c(state,wbhao), names_from = qtr, values_from = thresh700) %>%
select(state,wbhao,'2020 Q1':'2022 Q1') %>%
mutate(across('2020 Q2':'2022 Q1', ~.x-'2020 Q1'))
change_ts <- all_qtrs %>%
filter(gender=='All') %>%
select(state, wbhao, qtr, thresh700) %>%
pivot_wider(id_cols = c(state,wbhao), names_from = qtr, values_from = thresh700) %>%
select(state,wbhao,'2020 Q1':'2022 Q1') %>%
mutate(across(c('2020 Q2':'2022 Q1'), ~.x-'2020 Q1'))
change_ts <- all_qtrs %>%
filter(gender=='All') %>%
select(state, wbhao, qtr, thresh700) %>%
pivot_wider(id_cols = c(state,wbhao), names_from = qtr, values_from = thresh700) %>%
select(state,wbhao,'2020 Q1':'2022 Q1') %>%
mutate(across(c('2020 Q2':'2022 Q1'), ~ .x - '2020 Q1'))
change_ts <- all_qtrs %>%
filter(gender=='All') %>%
select(state, wbhao, qtr, thresh700) %>%
pivot_wider(id_cols = c(state,wbhao), names_from = qtr, values_from = thresh700) %>%
select(state,wbhao,'2020 Q1':'2022 Q1') %>%
mutate(across(c('2020 Q2':'2022 Q1'), ~ . - '2020 Q1'))
change_ts <- all_qtrs %>%
filter(gender=='All') %>%
select(state, wbhao, qtr, thresh700) %>%
pivot_wider(id_cols = c(state,wbhao), names_from = qtr, values_from = thresh700) %>%
select(state,wbhao,'2020 Q1':'2022 Q1') %>%
mutate(across('2020 Q2':'2022 Q1',.fns =  ~ . - '2020 Q1'))
change_ts <- all_qtrs %>%
filter(gender=='All') %>%
select(state, wbhao, qtr, thresh700) %>%
pivot_wider(id_cols = c(state,wbhao), names_from = qtr, values_from = thresh700) %>%
select(state,wbhao,'2020 Q1':'2022 Q1') %>%
mutate(across('2020 Q2':'2022 Q1',.fns =  ~ .x - '2020 Q1'))
change_ts <- all_qtrs %>%
filter(gender=='All') %>%
select(state, wbhao, qtr, thresh700) %>%
pivot_wider(id_cols = c(state,wbhao), names_from = qtr, values_from = thresh700) %>%
select(state,wbhao,'2020 Q1':'2022 Q1') %>%
mutate(across(c('2020 Q2':'2022 Q1'),.fns =  ~.x - '2020 Q1',
.names = '{.col}-1'))
change_ts <- all_qtrs %>%
filter(gender=='All') %>%
select(state, wbhao, qtr, thresh700) %>%
pivot_wider(id_cols = c(state,wbhao), names_from = qtr, values_from = thresh700) %>%
select(state,wbhao,'2020 Q1':'2022 Q1') %>%
mutate(across(c('2020 Q2':'2022 Q1'),.fns =  ~.x-'2020 Q1',
.names = '{.col}-1'))
change_ts <- all_qtrs %>%
filter(gender=='All') %>%
select(state, wbhao, qtr, thresh700) %>%
pivot_wider(id_cols = c(state,wbhao), names_from = qtr, values_from = thresh700) %>%
select(state,wbhao,'2020 Q1':'2022 Q1') %>%
mutate(across('2020 Q2',.fns =  ~.x-'2020 Q1',
.names = '{.col}-1'))
change_ts <- all_qtrs %>%
filter(gender=='All') %>%
select(state, wbhao, qtr, thresh700) %>%
pivot_wider(id_cols = c(state,wbhao), names_from = qtr, values_from = thresh700) %>%
select(state,wbhao,'2020 Q1':'2022 Q1') %>%
mutate(across('2020 Q2', ~.x-'2020 Q1',
.names = '{.col}-1'))
change_ts <- all_qtrs %>%
filter(gender=='All') %>%
select(state, wbhao, qtr, thresh700) %>%
pivot_wider(id_cols = c(state,wbhao), names_from = qtr, values_from = thresh700) %>%
select(state,wbhao,'2020 Q1':'2022 Q1') %>%
mutate(across('2020 Q2', .fns =  ~x-'2020 Q1',
.names = '{.col}-1'))
change_ts <- all_qtrs %>%
filter(gender=='All') %>%
select(state, wbhao, qtr, thresh700) %>%
pivot_wider(id_cols = c(state,wbhao), names_from = qtr, values_from = thresh700) %>%
select(state,wbhao,'2020 Q1':'2022 Q1') %>%
mutate(across('2020 Q2', .fns =  ~.-'2020 Q1',
.names = '{.col}-1'))
change_ts <- all_qtrs %>%
filter(gender=='All') %>%
select(state, wbhao, qtr, thresh700) %>%
pivot_wider(id_cols = c(state,wbhao), names_from = qtr, values_from = thresh700) %>%
select(state,wbhao,'2020 Q1':'2022 Q1') %>%
mutate(across('2020 Q2', .fns =  ~.x-'2020 Q1',
.names = '{.col}-1'))
change_ts <- all_qtrs %>%
filter(gender=='All') %>%
select(state, wbhao, qtr, thresh700) %>%
pivot_wider(id_cols = c(state,wbhao), names_from = qtr, values_from = thresh700) %>%
select(state,wbhao,'2020 Q1':'2022 Q1') %>%
mutate(across('2020 Q2', .fns =  ~.x-'2020 Q1',
.names = '{.col}-1'))
change_ts <- all_qtrs %>%
filter(gender=='All') %>%
select(state, wbhao, qtr, thresh700) %>%
pivot_wider(id_cols = c(state,wbhao), names_from = qtr, values_from = thresh700) %>%
select(state,wbhao,'2020 Q1':'2022 Q1') %>%
mutate(across('2020 Q2', .fns =  ~diff(.x,'2020 Q1'),
.names = '{.col}-1'))
change_ts <- all_qtrs %>%
filter(gender=='All') %>%
select(state, wbhao, qtr, thresh700) %>%
pivot_wider(id_cols = c(state,wbhao), names_from = qtr, values_from = thresh700) %>%
select(state,wbhao,'2020 Q1':'2022 Q1') %>%
mutate(across('2020 Q2', .fns =  ~.x - '2020 Q1'),
.names = '{.col}-1'))
change_ts <- all_qtrs %>%
filter(gender=='All') %>%
select(state, wbhao, qtr, thresh700) %>%
pivot_wider(id_cols = c(state,wbhao), names_from = qtr, values_from = thresh700) %>%
select(state,wbhao,'2020 Q1':'2022 Q1') %>%
mutate(across('2020 Q2', .fns =  ~.x - '2020 Q1',
.names = '{.col}-1'))
